# ๐ ุฏููู REST API ุงููุงูู - Noir Cafรฉ

## ๐ ูุธุฑุฉ ุนุงูุฉ

REST API ูุชูุงูู ููููู Noir Cafรฉ ูุฑุจุท Firebase ูุน Node.js/MongoDB ูุน ุฏุนู ูุงูู ูุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ูุงูููุงุท ูุงูุทูุจุงุช ูุงูููุชุฌุงุช.

## ๐ ุงููุตุงุฏูุฉ ูุงูุฃูุงู

### JWT Authentication
- **ูุฏุฉ ุงูุงูุชูุงุก**: 30 ุฏูููุฉ
- **Header**: `Authorization: Bearer <token>`
- **ุชุฌุฏูุฏ ุชููุงุฆู**: ุนุจุฑ `/api/auth/refresh`

### ุฃุฏูุงุฑ ุงููุณุชุฎุฏููู
- `user` - ูุณุชุฎุฏู ุนุงุฏู
- `admin` - ูุฏูุฑ ุงููุธุงู
- `staff` - ููุธู
- `manager` - ูุฏูุฑ ุงููููู

---

## ๐ ุงูู Endpoints ุงูุฃุณุงุณูุฉ

## 1. ๐ฅ Users API

### GET `/api/users`
**ุงููุตู**: ุฌูุจ ุฌููุน ุงููุณุชุฎุฏููู (ูุฏูุฑูู ููุท)  
**ุงูุตูุงุญูุฉ**: Admin only  
**Query Parameters**:
```
?page=1&limit=20&status=active&role=user
```

**Response**:
```json
{
  "status": "success",
  "message": "ุชู ุฌูุจ ูุงุฆูุฉ ุงููุณุชุฎุฏููู ุจูุฌุงุญ",
  "data": {
    "users": [...],
    "pagination": {
      "currentPage": 1,
      "totalPages": 5,
      "totalUsers": 100,
      "limit": 20,
      "hasNext": true,
      "hasPrev": false
    }
  }
}
```

### GET `/api/users/:id`
**ุงููุตู**: ุฌูุจ ูุณุชุฎุฏู ูุญุฏุฏ  
**ุงูุตูุงุญูุฉ**: Owner or Admin  

**Response**:
```json
{
  "status": "success",
  "message": "ุชู ุฌูุจ ุจูุงูุงุช ุงููุณุชุฎุฏู ุจูุฌุงุญ",
  "data": {
    "user": {
      "uid": "user123",
      "displayName": "ูุญูุฏ ุฃุญูุฏ",
      "email": "mohamed@example.com",
      "points": {
        "current": 250,
        "total": 1000,
        "used": 750
      },
      "role": "user",
      "status": "active",
      "createdAt": "2024-01-01T00:00:00.000Z"
    }
  }
}
```

### PATCH `/api/users/:id`
**ุงููุตู**: ุชุญุฏูุซ ุจูุงูุงุช ุงููุณุชุฎุฏู  
**ุงูุตูุงุญูุฉ**: Owner or Admin  

**Request Body**:
```json
{
  "points": 300,
  "status": "active",
  "role": "admin",
  "displayName": "ุงูุงุณู ุงูุฌุฏูุฏ",
  "profile": {
    "phone": "+966501234567"
  }
}
```

**Response**:
```json
{
  "status": "success",
  "message": "ุชู ุชุญุฏูุซ ุจูุงูุงุช ุงููุณุชุฎุฏู ุจูุฌุงุญ",
  "data": {
    "user": {...},
    "updatedFields": ["points", "displayName"]
  }
}
```

### DELETE `/api/users/:id`
**ุงููุตู**: ุญุฐู ูุณุชุฎุฏู (soft delete)  
**ุงูุตูุงุญูุฉ**: Admin only  

---

## 2. ๐ฐ Points API

### POST `/api/points/add`
**ุงููุตู**: ุฅุถุงูุฉ ููุงุท ูููุณุชุฎุฏู  
**ุงูุตูุงุญูุฉ**: Admin or Owner (ูุญุฏูุฏ)  

**Request Body**:
```json
{
  "userUid": "user123",
  "points": 100,
  "reason": "ุดุฑุงุก ุจุงูุฉ ููุงุท",
  "source": "purchase",
  "adminNote": "ุชูุช ุงูุฅุถุงูุฉ ุจูุฌุงุญ",
  "relatedOrder": "ORD-2024-001"
}
```

**Response**:
```json
{
  "status": "success",
  "message": "ุชู ุฅุถุงูุฉ ุงูููุงุท ุจูุฌุงุญ",
  "data": {
    "transaction": {...},
    "targetUser": {
      "uid": "user123",
      "displayName": "ูุญูุฏ ุฃุญูุฏ",
      "newBalance": 350
    },
    "pointsAdded": 100,
    "source": "purchase"
  }
}
```

### POST `/api/points/deduct`
**ุงููุตู**: ุฎุตู ููุงุท ูู ุงููุณุชุฎุฏู  
**ุงูุตูุงุญูุฉ**: Admin only  

### GET `/api/points/balance/:uid`
**ุงููุตู**: ุฌูุจ ุฑุตูุฏ ุงูููุงุท  
**ุงูุตูุงุญูุฉ**: Owner or Admin  

### GET `/api/points/transactions/:uid`
**ุงููุตู**: ุฌูุจ ุชุงุฑูุฎ ูุนุงููุงุช ุงูููุงุท  
**ุงูุตูุงุญูุฉ**: Owner or Admin  

### GET `/api/points/packages`
**ุงููุตู**: ุฌูุจ ุจุงูุงุช ุงูููุงุท ุงููุชุงุญุฉ  
**ุงูุตูุงุญูุฉ**: Public  

### POST `/api/points/purchase`
**ุงููุตู**: ุดุฑุงุก ุจุงูุฉ ููุงุท  
**ุงูุตูุงุญูุฉ**: Authenticated  

### POST `/api/points/redeem`
**ุงููุตู**: ุงุณุชุฎุฏุงู ุงูููุงุท ููุดุฑุงุก  
**ุงูุตูุงุญูุฉ**: Authenticated  

### GET `/api/points/stats`
**ุงููุตู**: ุฅุญุตุงุฆูุงุช ุงูููุงุท  
**ุงูุตูุงุญูุฉ**: Admin only  

---

## 3. ๐ Orders API

### POST `/api/orders`
**ุงููุตู**: ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ  
**ุงูุตูุงุญูุฉ**: Authenticated  

**Request Body**:
```json
{
  "items": [
    {
      "name": "ูููุฉ ุฃูุฑููุงูู",
      "price": 15,
      "pointsPrice": 10,
      "quantity": 2,
      "options": ["ุณูุฑ", "ุญููุจ"]
    }
  ],
  "orderType": "dine_in",
  "payment": {
    "method": "mixed",
    "cashAmount": 20,
    "pointsUsed": 10
  },
  "notes": {
    "customer": "ุจุฏูู ุณูุฑ"
  }
}
```

**Response**:
```json
{
  "status": "success",
  "message": "ุชู ุฅูุดุงุก ุงูุทูุจ ุจูุฌุงุญ",
  "data": {
    "order": {
      "orderNumber": "ORD-2024-001",
      "customer": {...},
      "items": [...],
      "totals": {
        "subtotal": 30,
        "tax": 4.5,
        "total": 34.5
      },
      "status": "pending"
    },
    "userBalance": {
      "current": 240,
      "total": 1000,
      "used": 760
    }
  }
}
```

### GET `/api/orders`
**ุงููุตู**: ุฌูุจ ุฌููุน ุงูุทูุจุงุช  
**ุงูุตูุงุญูุฉ**: Admin only  

**Query Parameters**:
```
?page=1&limit=20&status=pending&orderType=dine_in&startDate=2024-01-01&endDate=2024-01-31
```

### GET `/api/orders/:orderNumber`
**ุงููุตู**: ุฌูุจ ุทูุจ ูุญุฏุฏ  
**ุงูุตูุงุญูุฉ**: Owner or Staff  

### GET `/api/orders/user/:uid`
**ุงููุตู**: ุฌูุจ ุทูุจุงุช ุงููุณุชุฎุฏู  
**ุงูุตูุงุญูุฉ**: Owner or Staff  

### PUT `/api/orders/:orderNumber/status`
**ุงููุตู**: ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ  
**ุงูุตูุงุญูุฉ**: Staff only  

**Request Body**:
```json
{
  "status": "preparing",
  "staffInfo": {
    "name": "ุฃุญูุฏ ูุญูุฏ",
    "station": "ุงููุทุจุฎ"
  }
}
```

### DELETE `/api/orders/:orderNumber`
**ุงููุตู**: ุฅูุบุงุก ุงูุทูุจ (ูุน ุงุณุชุฑุฏุงุฏ ุงูููุงุท)  
**ุงูุตูุงุญูุฉ**: Owner (ุฎูุงู 10 ุฏูุงุฆู) or Admin  

### GET `/api/orders/today`
**ุงููุตู**: ุทูุจุงุช ุงูููู ูุน ุงูุฅุญุตุงุฆูุงุช  
**ุงูุตูุงุญูุฉ**: Staff only  

### GET `/api/orders/stats`
**ุงููุตู**: ุฅุญุตุงุฆูุงุช ููุตูุฉ ููุทูุจุงุช  
**ุงูุตูุงุญูุฉ**: Admin only  

### POST `/api/orders/:orderNumber/feedback`
**ุงููุตู**: ุฅุถุงูุฉ ุชูููู ููุทูุจ  
**ุงูุตูุงุญูุฉ**: Order Owner  

---

## 4. ๐ฐ Products API

### GET `/api/products`
**ุงููุตู**: ุฌูุจ ุฌููุน ุงูููุชุฌุงุช ูุน ููุชุฑุฉ ูุจุญุซ  
**ุงูุตูุงุญูุฉ**: Public  

**Query Parameters**:
```
?category=hot_drinks&featured=true&available=true&search=ูููุฉ&page=1&limit=20&sort=popular
```

**Response**:
```json
{
  "status": "success",
  "message": "ุชู ุฌูุจ ุงูููุชุฌุงุช ุจูุฌุงุญ",
  "data": {
    "products": [
      {
        "id": "prod123",
        "name": "ูููุฉ ุฃูุฑููุงูู",
        "description": "ูููุฉ ููุงุณูููุฉ ุจุทุนู ููู",
        "category": "hot_drinks",
        "pricing": {
          "regular": 15,
          "points": 10
        },
        "featured": true,
        "availability": {
          "isAvailable": true,
          "stock": 50
        },
        "ratings": {
          "average": 4.5,
          "count": 120
        }
      }
    ],
    "pagination": {...},
    "filters": {...}
  }
}
```

### GET `/api/products/featured`
**ุงููุตู**: ุงูููุชุฌุงุช ุงููููุฒุฉ  
**ุงูุตูุงุญูุฉ**: Public  

### GET `/api/products/bestsellers`
**ุงููุตู**: ุงูููุชุฌุงุช ุงูุฃูุซุฑ ูุจูุนุงู  
**ุงูุตูุงุญูุฉ**: Public  

### GET `/api/products/category/:category`
**ุงููุตู**: ููุชุฌุงุช ูุณู ูุนูู  
**ุงูุตูุงุญูุฉ**: Public  

### GET `/api/products/:id`
**ุงููุตู**: ุชูุงุตูู ููุชุฌ ูุญุฏุฏ  
**ุงูุตูุงุญูุฉ**: Public  

### POST `/api/products`
**ุงููุตู**: ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ  
**ุงูุตูุงุญูุฉ**: Staff only  

### PUT `/api/products/:id`
**ุงููุตู**: ุชุญุฏูุซ ููุชุฌ  
**ุงูุตูุงุญูุฉ**: Staff only  

### POST `/api/products/:id/rating`
**ุงููุตู**: ุฅุถุงูุฉ ุชูููู ููููุชุฌ  
**ุงูุตูุงุญูุฉ**: Authenticated  

### POST `/api/products/:id/sale`
**ุงููุตู**: ุชุณุฌูู ุจูุนุฉ ููููุชุฌ  
**ุงูุตูุงุญูุฉ**: Staff only  

---

## 5. ๐ Authentication API

### POST `/api/auth/firebase`
**ุงููุตู**: ุชุณุฌูู ุฏุฎูู ุนุจุฑ Firebase  
**ุงูุตูุงุญูุฉ**: Public  

### POST `/api/auth/login`
**ุงููุตู**: ุชุณุฌูู ุฏุฎูู ุจุงูุฅูููู ููููุฉ ุงููุฑูุฑ  
**ุงูุตูุงุญูุฉ**: Public  

### POST `/api/auth/register`
**ุงููุตู**: ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ  
**ุงูุตูุงุญูุฉ**: Public  

### POST `/api/auth/refresh`
**ุงููุตู**: ุชุญุฏูุซ JWT token  
**ุงูุตูุงุญูุฉ**: Public  

### GET `/api/auth/verify`
**ุงููุตู**: ุงูุชุญูู ูู ุตุญุฉ ุงูุชููู  
**ุงูุตูุงุญูุฉ**: Public  

### POST `/api/auth/logout`
**ุงููุตู**: ุชุณุฌูู ุงูุฎุฑูุฌ  
**ุงูุตูุงุญูุฉ**: Authenticated  

---

## ๐ ุญุงูุงุช ุงูุฑุฏ ุงูููุญุฏุฉ

### ูุฌุญ ุงูุทูุจ (2xx)
```json
{
  "status": "success",
  "message": "ุฑุณุงูุฉ ุงููุฌุงุญ ุจุงูุนุฑุจูุฉ",
  "data": { ... }
}
```

### ุฎุทุฃ ูู ุงูุจูุงูุงุช (400)
```json
{
  "status": "error",
  "message": "ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ",
  "errors": [
    {
      "field": "email",
      "message": "ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุบูุฑ ุตุญูุญ"
    }
  ]
}
```

### ุบูุฑ ูุตุฑุญ (401)
```json
{
  "status": "error",
  "message": "ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู"
}
```

### ููููุน (403)
```json
{
  "status": "error",
  "message": "ููุณ ูุฏูู ุตูุงุญูุฉ ุงููุตูู ููุฐุง ุงูููุฑุฏ"
}
```

### ุบูุฑ ููุฌูุฏ (404)
```json
{
  "status": "error",
  "message": "ุงูููุฑุฏ ุงููุทููุจ ุบูุฑ ููุฌูุฏ"
}
```

### ุฎุทุฃ ูู ุงูุฎุงุฏู (500)
```json
{
  "status": "error",
  "message": "ุฎุทุฃ ุฏุงุฎูู ูู ุงูุฎุงุฏู"
}
```

---

## ๐ง ุฃูุซูุฉ ุนูููุฉ

### 1. ุฅูุดุงุก ูุณุชุฎุฏู ุฌุฏูุฏ ูุฅุถุงูุฉ ููุงุท
```javascript
// 1. ุชุณุฌูู ุงููุณุชุฎุฏู
const registerResponse = await fetch('/api/auth/register', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    email: 'user@example.com',
    password: 'password123',
    displayName: 'ูุญูุฏ ุฃุญูุฏ'
  })
});

const { data: { token, user } } = await registerResponse.json();

// 2. ุฅุถุงูุฉ ููุงุท ุชุฑุญูุจูุฉ
const addPointsResponse = await fetch('/api/points/add', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    userUid: user.uid,
    points: 50,
    reason: 'ููุงุท ุชุฑุญูุจูุฉ',
    source: 'bonus'
  })
});
```

### 2. ุฅูุดุงุก ุทูุจ ูุน ุฏูุน ูุฎุชูุท
```javascript
const orderResponse = await fetch('/api/orders', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    items: [
      {
        name: 'ูููุฉ ูุงุชูู',
        price: 20,
        pointsPrice: 15,
        quantity: 1
      }
    ],
    orderType: 'takeaway',
    payment: {
      method: 'mixed',
      cashAmount: 10,
      pointsUsed: 15
    }
  })
});
```

### 3. ุฌูุจ ุฅุญุตุงุฆูุงุช ุดุงููุฉ (ูููุฏูุฑูู)
```javascript
const statsResponse = await fetch('/api/orders/stats?period=30', {
  headers: {
    'Authorization': `Bearer ${adminToken}`
  }
});

const pointsStatsResponse = await fetch('/api/points/stats', {
  headers: {
    'Authorization': `Bearer ${adminToken}`
  }
});
```

---

## ๐ Integration ูุน Frontend

### ุงุณุชุฎุฏุงู Auth Manager
```javascript
// ุชุณุฌูู ุงูุฏุฎูู ูุญูุธ ุงูุชููู
const loginData = await apiCall('/api/auth/firebase', {...});
authManager.login(loginData);

// ุทูุจ ูุญูู ุชููุงุฆูุงู
const userProfile = await authManager.apiRequest('/api/users/profile');

// ุฅุถุงูุฉ ููุงุท ูุน ุชุญุฏูุซ ุงููุงุฌูุฉ
const pointsResult = await authManager.apiRequest('/api/points/add', {
  method: 'POST',
  body: JSON.stringify({...})
});

// ุชุญุฏูุซ ุฅุฏุงุฑุฉ ุงูููุงุท
if (pointsResult.ok) {
  const data = await pointsResult.json();
  pointsManager.setPoints(data.data.targetUser.newBalance);
}
```

---

## ๐ Performance & Optimization

### Rate Limiting
- **Auth endpoints**: 5 requests/15 minutes
- **Points operations**: 30 requests/minute
- **General API**: 100 requests/minute

### Caching
- ุงูููุชุฌุงุช ุงููููุฒุฉ: 15 ุฏูููุฉ
- ุฅุญุตุงุฆูุงุช ุงููุธุงู: 5 ุฏูุงุฆู
- ุจูุงูุงุช ุงููุณุชุฎุฏู: 2 ุฏูููุฉ

### Pagination
- Default limit: 20 items
- Maximum limit: 100 items
- Total count included in response

---

## ๐ Testing Examples

### cURL Examples

#### Get Products
```bash
curl -X GET "http://localhost:3000/api/products?category=hot_drinks&limit=5" \
  -H "Content-Type: application/json"
```

#### Create Order (Authenticated)
```bash
curl -X POST "http://localhost:3000/api/orders" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "items": [{"name": "ูููุฉ", "price": 15, "quantity": 1}],
    "orderType": "dine_in",
    "payment": {"method": "cash", "cashAmount": 15}
  }'
```

#### Add Points (Admin)
```bash
curl -X POST "http://localhost:3000/api/points/add" \
  -H "Authorization: Bearer ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "userUid": "user123",
    "points": 100,
    "reason": "ููุงูุฃุฉ ุฎุงุตุฉ"
  }'
```

---

## ๐ Monitoring & Analytics

### Logs Format
```
โ Success: User user123 added 100 points (purchase)
โ Error: Authentication failed for /api/orders
๐ Info: Token refreshed for user user456
๐ฐ Points: 50 points added to user789 by admin123
```

### Key Metrics
- API response times
- Authentication success rate
- Points transaction volume
- Order completion rate
- Error frequency by endpoint

---

**๐ API ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูุน Firebase + Node.js + MongoDB!**

ููุฏุนู ุงูุชููู ุฃู ุงูุงุณุชูุณุงุฑุงุชุ ุฑุงุฌุน ุงูููุฏ ุฃู ุงุจุฏุฃ ุงูุฎุงุฏู ูุน `npm start`.
